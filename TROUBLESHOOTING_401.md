# üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ 401 Unauthorized

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–∫—É 401 Unauthorized –Ω–∞ –≤—Å–µ—Ö –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö (–∑–∞–∫–∞–∑—ã, –ø–æ–¥–ø–∏—Å–∫–∏, –∑–æ–Ω—ã).

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1. –ó–∞–≥–æ–ª–æ–≤–æ–∫ X-User-Id –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—à–∏–±–∫–∞ 401 —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º: "–¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫ X-User-Id —Å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-User-Id` –≤ Postman
- –ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ–º (ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Postman:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ –∑–∞–ø—Ä–æ—Å
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "Headers"
3. –î–æ–±–∞–≤—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫:
   - Key: `X-User-Id`
   - Value: `1` (–∏–ª–∏ –¥—Ä—É–≥–æ–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

---

### 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—à–∏–±–∫–∞ 401 —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å ID X –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"

**–†–µ—à–µ–Ω–∏–µ:**
1. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
   ```
   POST /api/auth/register
   {
       "phone": "+79051234567",
       "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
       "role": "CLIENT"
   }
   ```
   –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ `id` –∏–∑ –æ—Ç–≤–µ—Ç–∞!

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ID:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `id` –∏–∑ –æ—Ç–≤–µ—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
   - –ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ ID –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ Backend - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: `User with ID X not found in database`
- –ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î –Ω–∞–ø—Ä—è–º—É—é

---

### 3. –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ X-User-Id

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—à–∏–±–∫–∞ 401 —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º: "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ X-User-Id"

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ - —ç—Ç–æ —á–∏—Å–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1`, `2`, `3`)
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä–æ–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"1"` –∏–ª–∏ `"user1"`)

---

## –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ö–ª–∏–µ–Ω—Ç:**
```
POST http://localhost:8080/api/auth/register
Content-Type: application/json

{
    "phone": "+79051111111",
    "name": "–ö–ª–∏–µ–Ω—Ç –¢–µ—Å—Ç–æ–≤—ã–π",
    "role": "CLIENT"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
    "id": 1,
    "phone": "+79051111111",
    "name": "–ö–ª–∏–µ–Ω—Ç –¢–µ—Å—Ç–æ–≤—ã–π",
    "role": "CLIENT"
}
```

**–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ `id: 1` –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤!**

---

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Postman

–í –∫–æ–ª–ª–µ–∫—Ü–∏–∏ Postman –æ–±–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- `clientUserId` = `1` (ID –∏–∑ –æ—Ç–≤–µ—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
- `courierUserId` = `2` (–µ—Å–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏ –∫—É—Ä—å–µ—Ä–∞)
- `adminUserId` = `3` (–µ—Å–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏ –∞–¥–º–∏–Ω–∞)

**–ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å:**
1. –í Postman –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "Variables"
3. –û–±–Ω–æ–≤–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

---

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤ –∑–∞–ø—Ä–æ—Å–µ

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å:**
```
POST http://localhost:8080/api/orders
Headers:
  Content-Type: application/json
  X-User-Id: 1    ‚Üê –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!
Body:
{
    "address": "–û—Ä–µ–Ω–±—É—Ä–≥, —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10",
    "pickupTime": "2025-01-20T14:00:00+03:00"
}
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Backend

–ó–∞–ø—É—Å—Ç–∏—Ç–µ Backend –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏. –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è:

**‚úÖ –£—Å–ø–µ—à–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:**
```
INFO HeaderAuthenticationFilter: Request to /api/orders with X-User-Id: 1
INFO HeaderAuthenticationFilter: ‚úÖ Authentication set for user ID: 1 (role: CLIENT)
```

**‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω:**
```
INFO HeaderAuthenticationFilter: Request to /api/orders with X-User-Id: 999
ERROR HeaderAuthenticationFilter: ‚ùå User with ID 999 not found in database. Request path: /api/orders
```

**‚ö†Ô∏è –ó–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:**
```
WARN HeaderAuthenticationFilter: ‚ö†Ô∏è X-User-Id header is missing or empty. Request path: /api/orders
```

---

## –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±–æ–π –∑–∞–ø—Ä–æ—Å –≤ Postman
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "Headers"
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-User-Id`
4. –ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1`)

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `POST /api/auth/register`
2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ `id` –∏–∑ –æ—Ç–≤–µ—Ç–∞
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç `id` –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `X-User-Id`

### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É–±–ª–∏—á–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

–≠—Ç–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã **–ù–ï —Ç—Ä–µ–±—É—é—Ç** –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-User-Id`:
- `POST /api/auth/register`
- `POST /api/auth/send-code`
- `POST /api/auth/login`
- `GET /api/zones/active`

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Ö - –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞.

---

## –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

### –û—à–∏–±–∫–∞ 1: –ó–∞–±—ã–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-User-Id` –≤ Postman

### –û—à–∏–±–∫–∞ 2: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ID

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `id` –∏–∑ –æ—Ç–≤–µ—Ç–∞

### –û—à–∏–±–∫–∞ 3: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î

**–†–µ—à–µ–Ω–∏–µ:** 
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `POST /api/auth/register`
2. –ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î –Ω–∞–ø—Ä—è–º—É—é

### –û—à–∏–±–∫–∞ 4: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å—Ç—Ä–æ–∫—É –≤–º–µ—Å—Ç–æ —á–∏—Å–ª–∞

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
```
X-User-Id: "1"
X-User-Id: user1
```

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ:**
```
X-User-Id: 1
```

---

## –ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

‚úÖ –ó–∞–≥–æ–ª–æ–≤–æ–∫ `X-User-Id` –¥–æ–±–∞–≤–ª–µ–Ω –≤ Postman  
‚úÖ –ó–Ω–∞—á–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ - —á–∏—Å–ª–æ (ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)  
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º ID —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î  
‚úÖ –õ–æ–≥–∏ Backend –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Å–ø–µ—à–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é  

–ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã, –Ω–æ –æ—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Backend –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.







