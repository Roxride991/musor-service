# Инструкция по использованию Postman коллекции

## Импорт коллекции

1. Откройте Postman
2. Нажмите **Import**
3. Выберите файл `postman_collection.json`
4. Коллекция появится в вашем рабочем пространстве

## Настройка переменных

Коллекция использует следующие переменные (можно изменить в настройках коллекции):

- **baseUrl** - базовый URL API (по умолчанию: `http://localhost:8080`)
- **clientUserId** - ID пользователя с ролью CLIENT (по умолчанию: `1`)
- **courierUserId** - ID пользователя с ролью COURIER (по умолчанию: `2`)
- **adminUserId** - ID пользователя с ролью ADMIN (по умолчанию: `3`)
- **orderId** - ID заказа для тестирования (по умолчанию: `1`)
- **subscriptionId** - ID подписки для тестирования (по умолчанию: `1`)

## Порядок тестирования

### 1. Регистрация пользователей

1. **Регистрация (CLIENT)** - создайте клиента
   - Сохраните `id` из ответа в переменную `clientUserId`

2. **Регистрация (COURIER)** - создайте курьера
   - Сохраните `id` из ответа в переменную `courierUserId`

3. **Вход** - проверьте вход (код всегда `0000` в MVP)

### 2. Настройка зоны обслуживания (ADMIN)

**Важно:** Для создания заказов нужна активная зона!

1. **Создать/установить активную зону (ADMIN)**
   - Укажите `adminUserId` в заголовке `X-User-Id`
   - Передайте полигон координат (минимум 3 точки)
   - Пример: квадрат вокруг Оренбурга

### 3. Работа с подписками (CLIENT)

1. **Создать подписку (CLIENT)**
   - Выберите план: `WEEKLY` или `MONTHLY`
   - Сохраните `id` из ответа в `subscriptionId`

2. **Получить все подписки** - проверьте список

3. **Приостановить/Возобновить/Отменить** - тестируйте управление подпиской

### 4. Работа с заказами

#### Создание заказов (CLIENT)

1. **Создать разовой заказ (CLIENT)**
   - Обязательно укажите `lat` и `lng` (координаты должны быть в зоне обслуживания)
   - Время вывоза должно быть минимум через 1 час и не более 7 дней

2. **Создать заказ по подписке (CLIENT)**
   - Укажите `subscriptionId` (подписка должна быть активной)
   - Для заказов по подписке платёж не создаётся

#### Просмотр заказов

- **CLIENT** - видит только свои заказы
- **COURIER** - видит свободные (PUBLISHED) + свои активные (ACCEPTED, ON_THE_WAY, PICKED_UP)
- **ADMIN** - видит все заказы

#### Управление заказами

1. **Принять заказ (COURIER)**
   - Курьер берёт свободный заказ (статус меняется на ACCEPTED)

2. **Обновить статус заказа (COURIER)**
   - Доступные переходы: `ACCEPTED → ON_THE_WAY → PICKED_UP → COMPLETED`
   - Можно отменить: `ACCEPTED/ON_THE_WAY → CANCELLED_BY_COURIER`

3. **Отменить заказ (CLIENT)**
   - Можно отменить только до взятия курьером

4. **Обновить статус заказа (ADMIN)**
   - Администратор может установить любой статус

## Статусы заказов

- `PUBLISHED` - опубликован, ждёт курьера
- `ACCEPTED` - принят курьером
- `ON_THE_WAY` - курьер в пути
- `PICKED_UP` - мусор забран
- `COMPLETED` - завершён
- `CANCELLED_BY_CUSTOMER` - отменён клиентом
- `CANCELLED_BY_COURIER` - отменён курьером

## Примеры запросов

### Пример создания зоны (Оренбург)

```json
{
    "name": "Оренбург",
    "coordinates": [
        {"lat": 51.7687, "lng": 55.1017},
        {"lat": 51.7887, "lng": 55.1017},
        {"lat": 51.7887, "lng": 55.1217},
        {"lat": 51.7687, "lng": 55.1217}
    ]
}
```

### Пример создания заказа

```json
{
    "address": "г. Оренбург, ул. Ленина, д. 1",
    "pickupTime": "2025-11-06T14:00:00+03:00",
    "comment": "В подъезд",
    "lat": 51.7687,
    "lng": 55.1017
}
```

### Пример создания заказа по подписке

```json
{
    "address": "г. Оренбург, ул. Ленина, д. 2",
    "pickupTime": "2025-11-07T10:00:00+03:00",
    "comment": "У двери",
    "subscriptionId": 1,
    "lat": 51.7687,
    "lng": 55.1017
}
```

## Примечания

- Все запросы (кроме `/api/auth/**`) требуют заголовок `X-User-Id`
- Для регистрации ADMIN используйте прямые SQL-запросы (через API нельзя)
- Код подтверждения в MVP всегда `0000`
- Время в запросах используйте формат ISO 8601 с часовым поясом (например: `2025-11-06T14:00:00+03:00`)

